title = "Multirotor Drone Design"

# List of folder paths where user added custom registered OpenMDAO components
module_folders = ["../models"]

# Input and output files
input_file = "../workdir/problem_inputs_trajectory.xml"
output_file = "../workdir/problem_outputs.xml"

# Definition of problem driver assuming the OpenMDAO convention "import openmdao.api as om"
driver = "om.ScipyOptimizeDriver(tol=1e-6, optimizer='SLSQP')"#, debug_print=['totals'])"
#driver = "om.DifferentialEvolutionDriver()"
#driver = "om.ScipyOptimizeDriver(tol=1e-6, optimizer='COBYLA')"
#driver = "om.pyOptSparseDriver(optimizer='NSGA2')"

# Definition of OpenMDAO model
[model]
    # Solvers are defined assuming the OpenMDAO convention "import openmdao.api as om"
    #nonlinear_solver = "om.NonlinearBlockGS(maxiter=200)"
    #linear_solver = "om.DirectSolver()"

    # Although "model" is a mandatory name for the top level of the model, its
    # sub-components can be freely named by user
    [model.sizing_scenarios]
        id = "multirotor.sizing_scenarios"
    [model.propeller]
        id = "multirotor.propeller"
        use_catalogue = false
    [model.motor]
        id = "multirotor.motor"
        use_catalogue = false
        use_gearbox = false
    [model.battery]
        id = "energy.battery"
        use_catalogue = false
    [model.esc]
        id = "multirotor.esc"
        use_catalogue = false
    [model.structure]
        id = "multirotor.structure"
    [model.mission]
        id = "multirotor.missions"
    [model.system]
        id = "multirotor.system"


[optimization]  # This section is needed only if optimization process is run
[[optimization.design_var]]
        name = "data:system:settings:MTOW:k" # over sizing coefficient on the load mass
        lower = 1.0
        upper = 20.0

[[optimization.design_var]]
        name = "data:ESC:settings:mass:k" # over sizing coefficient on the battery load mass
        upper = 60.0  
        lower = 0.01    

[[optimization.design_var]]
        name = "data:structure:arms:settings:diameter:k" # aspect ratio D_out/D_in for the beam of the frame
        lower = 0.05
        upper = 0.99  

[[optimization.design_var]]
        name = "data:propeller:geometry:beta:estimated" # pitch/diameter ratio of the propeller
        lower = 0.3
        upper = 0.6

[[optimization.design_var]]
        name = "data:propeller:advance_ratio:climb" # climbing advance ratio
        upper = 0.5
        lower = 0.01
        
[[optimization.design_var]]
        name = "data:propeller:advance_ratio:forward" # forward flight advance ratio
        upper = 0.5
        lower = 0.01

[[optimization.design_var]]
        name = "data:motor:settings:torque:k" # over sizing coefficient on the motor torque
        lower = 1.0
        upper = 20.0

[[optimization.design_var]]
        name = "data:motor:settings:speed:k" # over sizing coefficient on the motor speed
        lower = 1.0
        upper = 10.0

[[optimization.design_var]]
        name = "data:ESC:settings:voltage:k" # over sizing coefficient for the battery voltage
        lower = 1.0
        upper = 5.0

[[optimization.design_var]]
        name = "data:propeller:settings:ND:k" # slow down propeller coef : ND = kNDmax / k_ND
        upper = 1.0
        lower = 0.01

[[optimization.design_var]]
        name = "data:ESC:settings:power:k" # over sizing coefficient on the ESC power
        lower = 1.0
        upper = 15.0

[[optimization.design_var]]
        name = "data:mission:speed:forward"
        lower = 1.0
        upper = 40

#[[optimization.design_var]]
#        name = "data:gearbox:N_red" # gearbox reduction ratio (if 'use_gearbox' is true)
#        lower = 1.0
#        upper = 20.0

[[optimization.constraint]]
        name = "data:ESC:constraints:power:climb"
        lower = 0.0
        
[[optimization.constraint]]
        name = "data:ESC:constraints:power:forward"
        lower = 0.0

[[optimization.constraint]]
        name = "data:ESC:constraints:voltage"
        lower = 0.0

[[optimization.constraint]]
        name = "data:battery:constraints:power:takeoff"
        lower = 0.0

[[optimization.constraint]]
        name = "data:battery:constraints:power:climb"
        lower = 0.0

[[optimization.constraint]]
        name = "data:battery:constraints:power:forward"
        lower = 0.0

[[optimization.constraint]]
        name = "data:battery:constraints:voltage:takeoff"
        lower = 0.0

[[optimization.constraint]]
        name = "data:battery:constraints:voltage:climb"
        lower = 0.0
        
[[optimization.constraint]]
        name = "data:battery:constraints:voltage:forward"
        lower = 0.0

[[optimization.constraint]]
        name = "data:motor:constraints:torque:climb"
        lower = 0.0

[[optimization.constraint]]
        name = "data:motor:constraints:torque:forward"
        lower = 0.0

[[optimization.constraint]]
        name = "data:motor:constraints:torque:takeoff"
        lower = 0.0

[[optimization.constraint]]
        name = "data:propeller:constraints:speed:climb"
        lower = 0.0
        upper = 0.01
        
[[optimization.constraint]]
        name = "data:propeller:constraints:speed:forward"
        lower = 0.0
        upper = 0.01

[[optimization.constraint]]
        name = "data:propeller:constraints:speed:max"
        lower = 0.0

[[optimization.constraint]]
        name = "data:system:constraints:mass:convergence"
        lower = 0.0
        

# MASS MINIMIZATION
[[optimization.constraint]]
        name = "data:battery:constraints:energy"
        lower = 0.0

[[optimization.objective]]
        name = "data:system:MTOW"
        scaler=1e-1


# ENERGY MINIMIZATION
#[[optimization.constraint]]
#        name = "data:battery:constraints:energy"
#        lower = 0.0

#[[optimization.objective]]
#        name = "data:mission:energy"
#        scaler=1e-3
        

# RANGE MAXIMIZATION
#[[optimization.constraint]]
#        name = "data:system:constraints:mass:MTOW"
#        lower = 0.0

#[[optimization.objective]]
#        name = "data:system:range:max"
#        scaler=-1e-3
    
    
# HOVER AUTONOMY MAXIMIZATION
#[[optimization.constraint]]
#        name = "data:system:constraints:mass:MTOW"
#        lower = 0.0

#[[optimization.objective]]
#        name = "data:system:time:hover:max"
#        scaler=-1e-1
        
 
