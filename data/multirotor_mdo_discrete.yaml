title: Multirotor Drone Design

# List of folder paths where user added custom registered OpenMDAO components
module_folders: 
    - ../models
    - ../models/Missions
    - ../models/Scenarios
    - ../models/System
    - ../models/Components/Energy/Battery
    - ../models/Components/ESC
    - ../models/Components/Motor
    - ../models/Components/Propeller
    - ../models/Components/Structure
    - ../models/Components/Cables
    - ../models/Add_ons/Safety
    
# Input and output files
#input_file: ../workdir/problem_inputs.xml
input_file: ../workdir/problem_outputs_continuous.xml # reuse previous results as initial guess
output_file: ../workdir/problem_outputs_discrete.xml

# Definition of problem driver assuming the OpenMDAO convention import openmdao.api as om
#driver: om.pyOptSparseDriver(optimizer='SLSQP')

# Definition of OpenMDAO model
model:
    Core:
        scenarios:
            id: multirotor.sizing_scenarios
        propeller:
            id: propeller
            use_catalogue: false
        motor:
            id: motor
            use_catalogue: false
            use_gearbox: false
        battery:
            id: energy.battery
            use_catalogue: false
        esc:
            id: esc
            use_catalogue: false
        structure:
            id: multirotor.structure
        cables:
            id: cables
        system:
            id: multirotor.system
        missions:
            sizing_mission:
                id: multirotor.design_mission
            #concordia_study:
            #    id: multirotor.mission_concordia
    #Addons:
    #    safety:
    #       id: addons.safety


optimization: # This section is needed only if optimization process is run
    
    design_variables:
      - name: data:system:settings:MTOW:k # over estimation coefficient on the load mass
        upper: 40.0
        lower: 1.0

      - name: data:battery:settings:mass:k # over estimation coefficient on the battery load mass
        lower: 0.01
        upper: 60.0
        
      - name: data:battery:settings:voltage:k # over estimation coefficient on the battery voltage
        lower: 1.0
        upper: 10.0

      - name: data:structure:arms:settings:diameter:k # aspect ratio D_out/D_in for the beam of the frame
        lower: 0.05
        upper: 0.99

      - name: data:propeller:geometry:beta:guess # pitch/diameter ratio of the propeller
        lower: 0.3
        upper: 0.6

      - name: data:propeller:advance_ratio:climb # climbing advance ratio
        lower: 0.01
        upper: 0.5

      - name: data:propeller:advance_ratio:forward # forward flight advance ratio
        lower: 0.01
        upper: 2.0

      - name: data:motor:settings:torque:k # over estimation coefficient on the motor torque
        lower: 1.0
        upper: 20.0

      - name: data:motor:settings:speed:k # over estimation coefficient on the motor speed
        lower: 1.0
        upper: 10.0

      - name: data:propeller:settings:ND:k # slow down propeller coef : k_nD = ND / NDmax
        lower: 0.01
        upper: 1.0

      - name: data:ESC:settings:power:k # over estimation coefficient on the ESC power
        lower: 1.0
        upper: 15.0

      #- name: mission:sizing_mission:forward:speed
      #  lower: 1.0
      #  upper: 40

#      - name: data:gearbox:N_red # gearbox reduction ratio (if 'use_gearbox' is true)
#        lower: 1.0
#        upper: 20.0


    constraints:
      - name: data:ESC:constraints:power:climb  # solved by k_esc
        lower: 0.0
        
      - name: data:ESC:constraints:power:forward  # solved by k_esc
        lower: 0.0

      - name: data:ESC:constraints:voltage  # solved by k_vb
        lower: 0.0

      - name: data:battery:constraints:power:takeoff  # solved by k_mot
        lower: 0.0

      - name: data:battery:constraints:power:climb  # solved by k_mot
        lower: 0.0

      - name: data:battery:constraints:power:forward  # solved by k_mot
        lower: 0.0

      - name: data:battery:constraints:voltage:takeoff  # solved by k_speedmot
        lower: 0.0

      - name: data:battery:constraints:voltage:climb  # solved by k_speedmot
        lower: 0.0

      - name: data:battery:constraints:voltage:forward  # solved by k_speedmot
        lower: 0.0

      - name: data:motor:constraints:torque:climb  # solved by k_mot
        lower: 0.0

      - name: data:motor:constraints:torque:forward  # solved by k_mot
        lower: 0.0

      - name: data:motor:constraints:torque:takeoff  # solved by k_mot
        lower: 0.0
        
      - name: data:propeller:constraints:speed:climb  # solved by k_nd
        lower: 0.0
        
      - name: data:propeller:constraints:speed:forward  # solved by k_nd
        lower: 0.0

      #- name: mission:constraints:speed:climb  # solved by J_cl
      #  lower: 0.0
      #  upper: 0.01
        
      #- name: mission:constraints:speed:forward  # solved by J_ff
      #  lower: 0.0
      #  upper: 0.01
        
      - name: mission:constraints:speed:climb  # for CMA-ES only
        equals: 0.0
        
      - name: mission:constraints:speed:forward  # for CMA-ES only
        equals: 0.0
      
      # constraint over battery energy required to carry on the specified mission
      - name: mission:sizing_mission:constraints:energy  # solved by k_mb
        lower: 0.0

      # Mass convergence to ensure consistency
      - name: data:system:constraints:mass:convergence  # solved by k_M
        lower: 0.0

      # MTOW specification (for autonomy or range maximization objectives)
      #- name: data:system:constraints:mass:MTOW
      #  lower: 0.0
        
      # ADD-ONS: SAFETY
      #- name: addons:safety:constraints:torque:hover
      #  lower: 0.0
      #- name: addons:safety:constraints:torque:forward
      #  lower: 0.0
      #- name: mission:concordia_study:constraints:energy
      #  lower: 0.0
        
      

    objective:
      # MASS MINIMIZATION
      - name: data:system:MTOW
        scaler: 1e-1

      # ENERGY MINIMIZATION
      #- name: mission:sizing_mission:energy
      #  scaler: 1e-3
        
      # MAX. RANGE MAXIMIZATION
      #- name: mission:sizing_mission:forward:distance:max
      #  scaler: -1e-3

      # HOVER AUTONOMY MAXIMIZATION
      #- name: mission:sizing_mission:hover:duration:max
      #  scaler: -1e-1
        
        
