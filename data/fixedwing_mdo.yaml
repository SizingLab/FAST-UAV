title: Fixed-Wing Drone Optimal Design

# List of folder paths where user added custom registered OpenMDAO components
module_folders: 
    - ../models
    - ../models/Missions
    - ../models/Scenarios
    - ../models/System
    - ../models/Propulsion/Energy/Battery
    - ../models/Propulsion/ESC
    - ../models/Propulsion/Motor
    - ../models/Propulsion/Propeller
    - ../models/Propulsion/Cables
    - ../models/Airframe
    - ../models/Stability
   
# Input and output files
input_file: ../workdir/problem_inputs.xml
output_file: ../workdir/problem_outputs.xml

# Definition of problem driver assuming the OpenMDAO convention import openmdao.api as om
driver: om.ScipyOptimizeDriver(tol=1e-9, optimizer='SLSQP')

# Definition of OpenMDAO model
model:
    scenarios:
        id: sizing_scenarios.fixedwing
    propulsion:
        propeller:
            id: propulsion.propeller
            use_catalogue: false
        motor:
            id: propulsion.motor
            use_catalogue: false
            use_gearbox: false
        battery:
            id: propulsion.battery
            use_catalogue: false
        esc:
            id: propulsion.esc
            use_catalogue: false
    airframe:
        id: airframe.fixedwing
        spar_model: "I_beam"  # "I_beam" or "pipe"
    cables:
        id: propulsion.cables.fixedwing
    system:
        id: system.fixedwing
    stability:
        id: stability.fixedwing
    mission:
        design_mission:
            id: mission.design


optimization: 
    
    design_variables:
    
        ## SYSTEM ##
      - name: data:system:MTOW:k # over estimation coefficient on the load mass
        lower: 1.0
        upper: 40.0
        
      - name: data:airframe:wing:loading:k
        lower: 0.01
        upper: 2.0
        
        ## AIRFRAME ##
      - name: data:airframe:aerodynamics:CD0:guess
        lower: 0.01
        upper: 1.0
      
      - name: data:airframe:wing:AR
        lower: 8.0
        upper: 15.0
        
      - name: data:airframe:tail:horizontal:AR
        lower: 3.0
        upper: 6.0
        
      - name: data:airframe:tail:vertical:AR
        lower: 0.9
        upper: 4.0
        
      - name: data:airframe:wing:lambda
        lower: 0.1
        upper: 1.0
        
      - name: data:airframe:wing:MAC:LE:x:k
        lower: 0.01
        upper: 1.0
        
      - name: data:airframe:tail:horizontal:arm:k
        lower: 0.01
        upper: 1.0
        
      #- name: data:airframe:wing:spar:diameter:k # replaced by "internal" design variable in OpenMDAO ExplicitComponent
      #  lower: 0.05
      #  upper: 0.99

        ## PROPULSION ##
      - name: data:battery:mass:k # over estimation coefficient on the battery load mass
        lower: 0.01
        upper: 60.0
        
      - name: data:battery:voltage:k # over estimation coefficient on the battery voltage
        lower: 1.0
        upper: 10.0

      - name: data:propeller:geometry:beta:guess # pitch/diameter ratio of the propeller
        lower: 0.48
        upper: 1.0

      - name: data:propeller:advance_ratio:climb # climbing advance ratio
        lower: 0.01
        upper: 1.2

      - name: data:propeller:advance_ratio:cruise # cruise advance ratio
        lower: 0.01
        upper: 1.2

      - name: data:motor:torque:k # over estimation coefficient on the motor torque
        lower: 1.0
        upper: 20.0

      - name: data:motor:speed:k # over estimation coefficient on the motor speed
        lower: 0.1
        upper: 10.0

      - name: data:propeller:ND:k # slow down propeller coef : k_ND: ND / NDmax
        lower: 0.01
        upper: 1.0

      - name: data:ESC:power:k # over estimation coefficient on the ESC power
        lower: 1.0
        upper: 15.0
      
        
    constraints:
    
        ## SYSTEM ##
      - name: data:system:constraints:mass:consistency # Mass consistency
        lower: 0.0

      #- name: data:system:constraints:mass:MTOW # MTOW specification
      #  lower: 0.0
        
      - name: data:airframe:wing:constraints:loading:stall  # minimum wing loading required for stall speed
        lower: 0.0
        
      - name: data:stability:static_margin  # static margin constraint
        lower: 0.05
        upper: 0.10
        
        ## AIRFRAME ##
      - name: data:airframe:aerodynamics:constraints:CD0:consistency # Drag consistency
        lower: 0.0
        upper: 0.01
        
      - name: data:airframe:fuselage:constraints:volume  # fuselage volume requirement
        lower: 0.0
        
      #- name: data:airframe:wing:constraints:spar:diameter  # replaced by "internal" constraint in OpenMDAO component
      #  lower: 0.0
      
        ## PROPULSION ##
      - name: data:ESC:constraints:power:climb
        lower: 0.0
        
      - name: data:ESC:constraints:power:cruise
        lower: 0.0

      - name: data:ESC:constraints:voltage
        lower: 0.0

      - name: data:battery:constraints:power:takeoff
        lower: 0.0

      - name: data:battery:constraints:power:climb
        lower: 0.0

      - name: data:battery:constraints:power:cruise
        lower: 0.0

      - name: data:battery:constraints:voltage:climb
        lower: 0.0

      - name: data:battery:constraints:voltage:cruise
        lower: 0.0

      - name: data:motor:constraints:torque:climb
        lower: 0.0

      - name: data:motor:constraints:torque:takeoff
        lower: 0.0
        
      - name: data:propeller:constraints:speed:climb
        lower: 0.0
        
      - name: data:propeller:constraints:speed:cruise
        lower: 0.0
      
        ## MISSION ##
      - name: mission:design_mission:constraints:speed:climb
        lower: 0.0
        upper: 0.01
        
      - name: mission:design_mission:constraints:speed:cruise
        lower: 0.0
        upper: 0.01
      
      # For mass minimization only:
      - name: mission:design_mission:constraints:energy  # Energy constraint
        lower: 0.0
      

    objective:
      # MASS MINIMIZATION
      - name: data:system:MTOW
        scaler: 1e-1
        
      # ENDURANCE MAXIMIZATION
      #- name: data:system:endurance:cruise:max
      #  scaler: -1e-3  # the use of a scaler is highly recommanded due to numerical precision affecting the final convergence.
