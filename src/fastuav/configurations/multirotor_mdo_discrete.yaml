title: Multirotor Drone Optimal Design with catalogue components selection

# List of folder paths where user added custom registered OpenMDAO components
module_folders:
    
# Input and output files
input_file: ../workdir/problem_inputs.xml
output_file: ../workdir/problem_outputs.xml

# Definition of problem driver assuming the OpenMDAO convention import openmdao.api as om
driver: om.ScipyOptimizeDriver(tol=1e-6, optimizer='SLSQP')
# driver: om.pyOptSparseDriver(optimizer='SLSQP')  # not supported yet for windows users
# driver: CMAESDriver()

# Definition of OpenMDAO model
model:
    scenarios:
        id: scenarios.multirotor
    propulsion:
        propeller:
            id: propulsion.propeller
            use_catalogue: true
        motor:
            id: propulsion.motor
            use_gearbox: false
            use_catalogue: false
        battery:
            id: propulsion.battery
            use_catalogue: false
        esc:
            id: propulsion.esc
            use_catalogue: false
    geometry:
        id: geometry.multirotor
    structures:
        id: structures.multirotor
    wires:
        id: propulsion.cables.multirotor
    performance:
        id: performance.multirotor
    mission:
        design_mission:
            id: mission.design


# This section is needed only if optimization process is run
optimization:
    
    design_variables:
    
        ## GLOBAL ##
      - name: data:weights:MTOW:k # over estimation coefficient on the load mass
        upper: 40.0
        lower: 1.0
        
        ## PROPULSION ##
      - name: data:propulsion:propeller:ND:k # slow down propeller coef : k_ND: ND / NDmax
        lower: 0.01
        upper: 1.0

      - name: data:propulsion:propeller:beta:guess # pitch/diameter ratio of the propeller
        lower: 0.3
        upper: 0.6

      - name: data:propulsion:propeller:advance_ratio:climb # climbing advance ratio
        lower: 0.01
        upper: 0.5

      - name: data:propulsion:propeller:advance_ratio:cruise # cruise advance ratio
        lower: 0.01
        upper: 2.0

      - name: data:propulsion:motor:torque:k # over estimation coefficient on the motor torque
        lower: 1.0
        upper: 20.0

      - name: data:propulsion:motor:speed:k # over estimation coefficient on the motor speed
        lower: 0.1
        upper: 10.0

      - name: data:weights:battery:mass:k # over estimation coefficient on the battery load mass
        lower: 0.01
        upper: 60.0
        
      - name: data:propulsion:battery:voltage:k # over estimation coefficient on the battery voltage
        lower: 1.0
        upper: 10.0

      - name: data:propulsion:esc:power:k # over estimation coefficient on the ESC power
        lower: 1.0
        upper: 15.0
        
      # - name: data:propulsion:gearbox:N_red # gearbox reduction ratio (if 'use_gearbox' option for motor is true)
      #   lower: 1.0
      #   upper: 20.0
        
        ## STRUCTURE ##
      - name: data:structures:arms:diameter:k # aspect ratio D_out/D_in for the beam of the frame
        lower: 0.05
        upper: 0.99

        ## MISSION ##
      # - name: mission:design_mission:cruise:speed
      #   lower: 1.0
      #   upper: 40

    constraints:
    
        ## GLOBAL ##
      - name: data:weights:MTOW:guess:constraint # Mass consistency
        lower: 0.0

      - name: data:weights:MTOW:constraint # MTOW specification
        lower: 0.0
        
        ## PROPULSION ##
      - name: data:propulsion:propeller:constraints:speed:climb  # propeller speed in climb
        lower: 0.0
        
      - name: data:propulsion:propeller:constraints:speed:cruise  # propeller speed in cruise
        lower: 0.0
        
      - name: data:propulsion:motor:constraints:torque:takeoff  # motor torque at takeoff
        lower: 0.0
        
      - name: data:propulsion:motor:constraints:torque:hover  # motor torque in hover
        lower: 0.0
        
      - name: data:propulsion:motor:constraints:torque:climb  # motor torque in climb
        lower: 0.0
      
      - name: data:propulsion:battery:constraints:power:takeoff  # battery power at takeoff
        lower: 0.0

      - name: data:propulsion:battery:constraints:power:climb  # battery power in climb
        lower: 0.0

      - name: data:propulsion:battery:constraints:power:cruise  # battery power in cruise
        lower: 0.0

      - name: data:propulsion:battery:constraints:voltage:climb  # battery voltage in climb
        lower: 0.0

      - name: data:propulsion:battery:constraints:voltage:cruise  # battery voltage in cruise
        lower: 0.0
      
      - name: data:propulsion:esc:constraints:power:climb  # ESC power in climb
        lower: 0.0
        
      - name: data:propulsion:esc:constraints:power:cruise  # ESC power in cruise
        lower: 0.0

      - name: data:propulsion:esc:constraints:voltage  # ESC voltage
        lower: 0.0
      
        ## MISSION ##
      - name: mission:design_mission:constraints:speed:climb  # climb speed requirement
        lower: 0.0
        upper: 0.01
        
      - name: mission:design_mission:constraints:speed:cruise  # cruise speed requirement
        lower: 0.0
        upper: 0.01
      
      - name: mission:design_mission:constraints:energy  # energy requirement to fulfill mission (e.g. for mass minimization objective)
        lower: 0.0

      ### Additional constraints required because of catalog selection ###
        
      #- name: data:propulsion:battery:constraints:voltage:takeoff  # not enforced anymore by sizing procedure Vbat = kv * Umot_to
      #  lower: 0.0
        
      #- name: data:propulsion:motor:constraints:torque:hover  # not enforced anymore by sizing procedure Tnom = kmot * T_hov
      #  lower: 0.0
        
      #- name: data:propulsion:esc:constraints:power:takeoff  # not enforced anymore by sizing procedure Pesc = kesc * Pmot_to * Vbat / Umot_to
      #  lower: 0.0
      

    objective:
      # MASS MINIMIZATION
      - name: data:weights:MTOW
        scaler: 1.e-1

      # ENERGY MINIMIZATION
      #- name: mission:design_mission:energy
      #  scaler: 1e-3
        
      # MAX. RANGE MAXIMIZATION
      #- name: data:performance:range:max
      #  scaler: -1e-3

      # HOVER AUTONOMY MAXIMIZATION
      #- name: data:performance:endurance:hover:max
      #  scaler: -1e-1
        
        
